all:
	mkdir ../release &> /dev/null || true
	go build -o ../release/ease-cve cve.go

release: all
	strip ../release/ease-cve

fmt:
	go fmt cve.go

clean:
	rm -rf ../release/*

kill:
	pkill -x ease-notify || true

install: kill
	mkdir -p ${DESTDIR}/usr/bin &> /dev/null || true
	mkdir -p ${DESTDIR}/etc/ease &> /dev/null || true
	mkdir -p ${DESTDIR}/var/log/ease &> /dev/null || true
	mkdir -p ${DESTDIR}/usr/lib/systemd/system &> /dev/null || true
	cp ../release/ease-cve ${DESTDIR}/usr/bin/
	cp notify.py ${DESTDIR}/usr/bin/ease-notify
	cp ease.service ${DESTDIR}/usr/lib/systemd/system/
	touch ${DESTDIR}/var/log/ease/log
	systemctl daemon-reload

uninstall:
	rm ${DESTDIR}/usr/bin/ease-cve
	rm ${DESTDIR}/usr/bin/ease-notify
	rm -rf ${DESTDIR}/var/log/ease
	rm ${DESTDIR}/usr/lib/systemd/system/ease.service
	systemctl daemon-reload
