.PHONY: default hellp build attach destroy daemon status

APP=cve-ease
VERSION=V0.0.2
DOCKER_IMAGE=$(APP)-$(VERSION)
CONTAINER_NAME=$(APP)-$(VERSION)

default:
	@echo ""
	@echo "Makefile for $(APP) using docker image $(DOCKER_IMAGE)"
	@echo "maintainers: youyifeng <youyf2@chinatelecom.cn>"
	@echo ""
	@echo "help		show help info(default)"
	@echo "status	  show docker status"
	@echo "build	   build docker image"
	@echo "attach	  attach container"
	@echo "destroy	 destroy container"
	@echo "daemon	  start an container with daemon"

help: default

build:
	cp ../release/cve-ease-*x86_64.rpm . -a
	@echo " copy rpm ok"
	docker build -t cve-ease:v0.0.2 .
	@echo " docker build ok"
	docker image ls cve-ease

attach:
	docker exec -it $(CONTAINER_NAME) /bin/bash

destroy:
	docker container rm --force $(CONTAINER_NAME) || :

daemon:
	docker image ls -a
	docker run -d --privileged \
		--name $(CONTAINER_NAME) \
		$(DOCKER_IMAGE) \
		/sbin/init

status:
	systemctl status docker --no-pager
	docker image ls $(DOCKER_IMAGE)
	docker container ls --filter name=$(CONTAINER_NAME)
	@echo "All ok!"
