# -*- coding: utf-8 -*-

"""
 (c) 2023 - Copyright CTyunOS Inc

 Authors:
   youyifeng <youyf2@chinatelecom.cn>

"""
import os
from optparse import OptionParser
from cve_ease_dev import activate_session, Scraper
from sqlalchemy import select
import logging
import json
from cve_ease_dev.helper import parseRPM
from cve_ease_dev.models import Repos, Repo, Package

logger = logging.getLogger('cve-ease')


def get_usage_str(usage):
    return usage + "\n(Specify the --help global option for a list of other help options)"


openeuler_product_map = [
    "https://mirrors.tuna.tsinghua.edu.cn/openeuler/openEuler-20.03-LTS-SP1/everything/x86_64/",
    "https://mirrors.tuna.tsinghua.edu.cn/openeuler/openEuler-20.03-LTS-SP1/update/x86_64/",
]


def parser_repo():
    repos = Repos()
    for repo in openeuler_product_map:
        print("makecache %s" % repo)
        repos.addrepo(repo)
    return repos


def handle_repodata(gconfig, db_session, args):
    usage = "usage: %prog repodata <options>"
    parser = OptionParser(usage=get_usage_str(usage))

    parser.add_option('-c', '--check', dest='check', action='store_true', default=False,
                      help='Check repo cve')
    parser.add_option('-v', '--verbose', dest='verbose', action='store_true', default=False,
                      help='Show verbose output')

    (options, args) = parser.parse_args(args)

    session = activate_session(db_session, gconfig)
    if gconfig.debug:
        print("active sql session")

    if options.check:
        repos = parser_repo()
