# -*- coding: utf-8 -*-

"""
 (c) 2023 - Copyright CTyunOS Inc

 Authors:
   youyifeng <youyf2@chinatelecom.cn>

"""

from optparse import OptionParser
from cve_ease_dev.notifier import MailQQ
import logging
from cve_ease_dev.helper import get_timestamp

logger = logging.getLogger('cve-ease')


def get_usage_str(usage):
    return usage + "\n(Specify the --help global option for a list of other help options)"


def handle_mailqq(gconfig, db_session, args):
    """[notifier] Notifier of mailqq """
    usage = "usage: %prog mailqq <options>"
    parser = OptionParser(usage=get_usage_str(usage))

    parser.add_option('-t', '--test', dest='test', action='store_true', default=False,
                      help='run test')
    parser.add_option('-v', '--verbose', dest='verbose', action='store_true', default=False,
                      help='show verbose output')
    parser.add_option('-c', '--content', dest='content', default=None, help='show verbose output')

    (options, args) = parser.parse_args(args)

    if options.test:
        print(" * run mailqq notifier test")
        notifier = MailQQ(gconfig, keyname='status_key')
        if options.content:
            if options.verbose:
                notifier.send_text(options.content, debug=True)
            else:
                notifier.send_text(options.content)
        else:
            msg = 'cve-ease notifier: \n%s\n%s' % (get_timestamp(), "cve-ease mailqq notifyer")
            if options.verbose:
                notifier.send_text(msg, debug=True)
            else:
                notifier.send_text(msg)
    else:
        parser.print_help()