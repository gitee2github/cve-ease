Name:           cve-ease
Version:        VERSION
Release:        RELEASE%{?dist}
Summary:        CTyunOS cve-ease project.
URL:            https://gitee.com/openeuler/cve-ease
License:        MulanPSL2
Source0:        cve-ease-%{version}.tar.bz2

BuildRequires:  golang >= 1.13

%description
CTyunOS cve-ease project.

Provides:       %{name} = %{version}-%{release}
Group:          System Environment/Daemons

%{?systemd_requires}

%prep
tar -zxf %{_sourcedir}/%{name}-%{version}.tar.gz 

%build
cd %{name}-%{version}
go mod tidy
make release

%install
rm -rf %{buildroot}
mkdir -p %{buildroot}/usr/bin/
mkdir -p %{buildroot}/usr/lib/systemd/system/
mkdir -p %{buildroot}/var/log/cve-ease/
cd %{_builddir}/%{name}-%{version}
make install DESTDIR=%{buildroot}
touch %{buildroot}/var/log/cve-ease/log

%post
%systemd_post cve-ease.service
systemctl enable cve-ease.service

%preun
%systemd_preun cve-ease.service

%postun
%systemd_postun_with_restart cve-ease.service


%files
%attr(0755,root,root) /usr/bin/ease-notify
%attr(0644,root,root) /usr/lib/systemd/system/cve-ease.service
%attr(0644,root,root) /usr/lib/systemd/system/cve-ease.timer
%attr(0644,root,root) /var/log/cve-ease/log

%changelog
* Mon May 9 2022 youyifeng <youyf2@chinatelecom.cn> - 0.0.2-1
- First publish
